---
description: 
globs: src/components/table.ts
alwaysApply: false
---
# 表格组件设计

## 核心设计
- 基于 HTML 原生表格元素构建(table, tr, td)
- 使用 TableManager 类管理表格相关操作
- 支持行列操作、单元格合并拆分等功能
- 支持矩形区域选择

## 单元格选择实现
- 通过mousedown、mousemove和mouseup事件实现框选
- 使用二维矩阵记录单元格位置和占用情况
- 处理选择端点为colspan和rowspan合并单元格时的选择逻辑, 最大化矩形范围
- 框选时按照矩形区域选择单元格

## 合并单元格原则
- 只有完全包含在选区内的单元格才能被合并
- 当选区与某单元格有交集但未完全包含该单元格时，禁用合并功能
- 合并操作保留第一个单元格，删除其他单元格

## 选区计算逻辑
1. 通过calculateCellDetails计算每个单元格的实际位置范围(考虑合并单元格)
2. 通过getCellsRange计算两个单元格间的矩形选区范围
3. 通过hasPartiallyOverlappingCells检测是否有部分重叠单元格，根据结果决定是否启用合并功能

## 用户体验
- 提供直观的单元格操作菜单
- 合并单元格时自动禁用不合理的操作
- 通过视觉反馈(高亮)显示选中的单元格 