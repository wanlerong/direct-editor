# DraftJS 到 Direct-Editor 迁移计划

## Epic 1: 核心编辑功能完善
**优先级**: 高
**目标**: 补齐缺失的核心编辑功能，确保编辑器基本可用

### Story 1.1: 基础组件功能实现
**优先级**: 高
**价值**: 支持富媒体内容编辑，满足基本文档需求

#### Task 1.1.1: 附件 Block 实现
- 创建附件上传组件
- 支持多种文件格式（文档、视频等）
- 实现附件下载功能
- 添加附件大小和类型限制

#### Task 1.1.2: 公式 Block 实现  
- 集成数学公式渲染引擎（如 KaTeX）
- 创建公式编辑界面
- 支持行内和块级公式
- 添加常用公式模板

### Story 1.2: 扩展组件实现
**优先级**: 中
**价值**: 提供专业图表绘制能力

#### Task 1.2.1: 流程图 Block 实现
- 集成流程图绘制库（如 Mermaid）
- 创建流程图编辑器界面
- 支持多种流程图类型
- 实现流程图导出功能

## Epic 2: 数据迁移与兼容
**优先级**: 高  
**目标**: 平滑迁移现有 DraftJS 数据，确保无数据丢失

### Story 2.1: 数据转换引擎开发
**优先级**: 高
**价值**: 保护用户现有内容投入，确保平滑迁移

#### Task 2.1.1: DraftJS 数据解析器
- 解析 DraftJS contentState 格式
- 提取 blocks、inlineStyleRanges、entityRanges
- 处理嵌套结构和特殊字符

#### Task 2.1.2: Direct-Editor 数据生成器
- 将解析后的数据转换为 HTML 格式
- 映射样式属性到对应的 HTML 标签
- 生成 data-btype 属性标识

#### Task 2.1.3: 样式映射规则实现
- 实现行内样式转换（BOLD → font-weight:bold）
- 实现块级元素转换（header-one → h1[data-btype="heading"]）
- 处理实体转换（LINK → a 标签）

### Story 2.2: 降级处理策略
**优先级**: 中
**价值**: 优雅处理不支持的功能，避免数据丢失

#### Task 2.2.1: 高亮文字降级
- 检测 HIGHLIGHT 样式
- 转换为 BOLD 样式
- 记录转换日志

#### Task 2.2.2: 复杂组件降级
- 信息块 → basic block
- 步骤条 → 有序列表  
- 题目 → 引用块
- 知识卡片 → 引用块
- 折叠面板 → 标题+内容
- Tab页 → 多个标题+内容
- 自定义窗格 → 表格

#### Task 2.2.3: 直接移除组件
- 分割线直接删除
- 图表直接删除  
- 思维导图直接删除

## Epic 3: 迁移工具与测试
**优先级**: 中
**目标**: 提供便捷的迁移工具和完整的测试覆盖

### Story 3.1: 迁移工具开发
**优先级**: 中
**价值**: 简化用户迁移流程，提高迁移成功率

#### Task 3.1.1: 批量转换工具
- 支持单文件和批量文件转换
- 提供转换进度显示
- 生成转换报告

#### Task 3.1.2: 转换预览功能
- 转换前后对比显示
- 高亮显示变更内容
- 支持手动调整

### Story 3.2: 质量保证
**优先级**: 中
**价值**: 确保迁移质量和系统稳定性

#### Task 3.2.1: 单元测试覆盖
- 数据转换逻辑测试
- 边界情况测试
- 错误处理测试

#### Task 3.2.2: 集成测试
- 端到端迁移流程测试
- 大文件转换性能测试
- 并发转换稳定性测试

#### Task 3.2.3: 用户验收测试
- 准备测试数据集
- 邀请用户试用反馈
- 修复发现的问题

---

**总体时间预估**: 8-12 周
**关键里程碑**:
- 第 4 周: Epic 1 完成，编辑器功能齐全
- 第 8 周: Epic 2 完成，数据迁移可用  
- 第 10 周: Epic 3 完成，工具完善